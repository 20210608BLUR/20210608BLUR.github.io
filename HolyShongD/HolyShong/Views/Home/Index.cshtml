@model HomeViewModel

@{
    HttpCookie cookie = HttpContext.Current.Request.Cookies.Get(FormsAuthentication.FormsCookieName);

    string userid = "";
    var address = new List<AddressDetail>();
    if (cookie != null)
    {
        FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(cookie.Value);
        userid = ticket.Name;
        address = new HolyShong.Services.AddressService().GetAddresses(int.Parse(userid)).AddressDetails;
    }

    //loginId = ViewData["memberId"];
}
<main>
    <!-- 主分類 -->
    <ul id="maincategory" class=" border-bottom  d-flex  overflow-auto align-items-center ">
        @foreach (var item in Model.StoreCategoryBlocks)
        {
            <li class="nav-item ">
                <a class="nav-link" href="~/Home/StoreCategorySearch/@item.StoreCategoryId">
                    <img alt="" role="presentation" src="@item.StoreCategoryImg">
                    <div class="d-flex justify-content-center">
                        <span>@item.StoreCategoryName</span>
                    </div>
                </a>
            </li>
        }
    </ul>

    <!-- 活動店家(幻燈片) -->
    <div id="eventstore">

        <div class="uk-position-relative uk-visible-toggle uk-light " tabindex="-1" uk-slider="center: false">

            <ul class="uk-slider-items uk-grid ">

                @foreach (var item in Model.DiscountBlocks)
                {
                    if (item.DiscountStoreImg != null)
                    {
                        <li class="uk-width-1-3@l uk-width-1-1 ">
                            <div class="uk-panel ">
                                <a href="~/Store/Marketing/@item.DiscountStoreId">
                                    <img src="@item.DiscountStoreImg" alt="">
                                </a>
                            </div>
                        </li>
                    }
                }
            </ul>

            <a class="uk-position-center-left uk-position-small uk-hidden-hover" href="#" uk-slidenav-previous
               uk-slider-item="previous"></a>
            <a class="uk-position-center-right uk-position-small uk-hidden-hover" href="#" uk-slidenav-next
               uk-slider-item="next"></a>

        </div>

    </div>

    <!-- 主要頁面 -->
    <div id="mainpage" class="d-flex mw-100">

        <!-- 副分類 -->
        @Html.Partial("_SubCategoryPartial")

        <!-- 商品類別 -->
        <div id="shopcategory w-100">

            <!-- 店家欄(分類) -->
            <div id="storecategory">

                <!-- 最愛店家 -->
                @if (userid != "")
                {
                    foreach (var item in Model.FavorateBlocks)
                    {
                        if (item.StoreCards.Count() != 0)
                        {
                            <div class="blocktitle d-flex align-items-center justify-content-between">
                                <h2>您的最愛商家</h2><a href="~/Member/FavoriteStore">查看全部</a>
                            </div>
                            <!-- 店家(幻燈片) -->
                            <div class="uk-panel">
                                <!-- 店家卡片(幻燈片) -->
                                <div class="storecard">
                                    <div class="uk-position-relative uk-visible-toggle uk-light" tabindex="-1" uk-slider="center: false">

                                        <ul class="uk-slider-items uk-grid ">
                                            @foreach (var card in item.StoreCards)
                                            {
                                                <li class=" uk-width-1-3@l uk-width-1-1">
                                                    <div class="uk-panel">
                                                        <!-- 商店卡(LEO) -->
                                                        <div class="cardCol">
                                                            <div class="foodCard" style="cursor:pointer;">
                                                                <a href="~/Store/Restaurant/@card.StoreId" style="text-decoration:none;">
                                                                    <div class="headline">
                                                                        <img class="pic" src="@card.StoreImg">
                                                                        @if (card.DiscountTag)
                                                                        {
                                                                            <div class="Tag">活動</div>
                                                                        }
                                                                    </div>
                                                                    <div class="foodText">
                                                                        <div class="shopNameandPoint">
                                                                            <div id="spName" class="shopName">@card.StoreName</div>
                                                                            @if (card.StoreScore >= 1)
                                                                            {
                                                                                <div id="pp" class="point">@card.StoreScore.ToString("#0.0")</div>
                                                                            }
                                                                            else
                                                                            {
                                                                                <div id="pp" class="point">-</div>

                                                                            }
                                                                        </div>
                                                                        @*<div class="TWD">
                                                                                <span id="ntd" class="">30 TWD 費用</span>
                                                                                <div class="dotSpace"><span class="dot"> • </span></div>
                                                                                <span id="min" class="">@card.DeliverTime 分鐘</span>
                                                                            </div>*@
                                                                    </div>
                                                                </a>
                                                            </div>
                                                            <div class="touchZone" style="cursor:pointer;">
                                                                <div class="favoriteHeart">
                                                                    <div class="switchP" id="sw" onclick="clickChangeC()">
                                                                        <!-- 空心 -->
                                                                        <i class="far fa-heart hEmpty"></i>
                                                                        <!-- 實心 -->
                                                                        <i class="fas fa-heart hSolid"></i>
                                                                        <i class="fas fa-heart hSolid4hover"></i>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            }
                                        </ul>

                                        <a class="uk-position-center-left uk-position-small uk-hidden-hover" href="#" uk-slidenav-previous
                                           uk-slider-item="previous"></a>
                                        <a class="uk-position-center-right uk-position-small uk-hidden-hover" href="#" uk-slidenav-next
                                           uk-slider-item="next"></a>

                                    </div>
                                </div>
                            </div>


                        }
                    }
                }


                <!-- 邀請好友 -->
                @Html.Partial("_ToEatPass")

                <!-- 分類標題 -->
                @foreach (var item in Model.StoreCardBlocks)
                {
                    <div class="blocktitle d-flex align-items-center justify-content-between">
                        <h2>@item.StoreCategoryName</h2><a href="~/Home/StoreCategorySearch/@item.StoreCategoryId">查看全部</a>
                    </div>
                    <!-- 店家(幻燈片) -->
                    <div class="uk-panel">
                        <!-- 店家卡片(幻燈片) -->
                        <div class="storecard">
                            <div class="uk-position-relative uk-visible-toggle uk-light" tabindex="-1" uk-slider="center: false">

                                <ul class="uk-slider-items uk-grid ">
                                    @foreach (var card in item.StoreCards)
                                    {
                                        <li class=" uk-width-1-3@l uk-width-1-1">
                                            <div class="uk-panel">
                                                <!-- 商店卡(LEO) -->
                                                <div class="cardCol">
                                                    <div class="foodCard" style="cursor:pointer;">
                                                        <a href="~/Store/Restaurant/@card.StoreId" style="text-decoration:none;">
                                                            <div class="headline">
                                                                <img class="pic" src="@card.StoreImg">
                                                                @if (card.DiscountTag)
                                                                {
                                                                    <div class="Tag">活動</div>
                                                                }
                                                            </div>
                                                            <div class="foodText">
                                                                <div class="shopNameandPoint">
                                                                    <div id="spName" class="shopName">@card.StoreName</div>
                                                                    @if (card.StoreScore >= 1)
                                                                    {
                                                                        <div id="pp" class="point">@card.StoreScore.ToString("#0.0")</div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <div id="pp" class="point">-</div>

                                                                    }
                                                                </div>

                                                            </div>
                                                        </a>
                                                    </div>
                                                    <div class="touchZone" style="cursor:pointer;">
                                                        <div class="favoriteHeart">
                                                            <div class="switchP" id="heart_@card.StoreId" onclick="clickChangeC(@card.StoreId,this.id)">
                                                                @if (card.isFavStore)
                                                                {
                                                                    <!-- 實心 -->
                                                                    <i class="fas fa-heart hSolid"></i>
                                                                }
                                                                else
                                                                {
                                                                    <!-- 空心 -->
                                                                    <i class="far fa-heart hEmpty"></i>
                                                                }

                                                            </div>
                                                            <!--<div class="switchP" id="sw" onclick="clickChangeC()">-->
                                                            <!-- 空心 -->
                                                            <!--<i class="far fa-heart hEmpty"></i>-->
                                                            <!-- 實心 -->
                                                            <!--<i class="fas fa-heart hSolid"></i>
                                                                <i class="fas fa-heart hSolid4hover"></i>
                                                            </div>-->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    }
                                </ul>

                                <a class="uk-position-center-left uk-position-small uk-hidden-hover" href="#" uk-slidenav-previous
                                   uk-slider-item="previous"></a>
                                <a class="uk-position-center-right uk-position-small uk-hidden-hover" href="#" uk-slidenav-next
                                   uk-slider-item="next"></a>

                            </div>
                        </div>
                    </div>
                }
                <!-- 顯示更多餐聽 -->
                <div class="d-flex justify-content-center" style="margin: 40px;">
                    <button type="button" class="btn btn-dark" style="width: 150px;height: 60px;font-size: 18px; " onclick="location.href='@Url.Action("Search", "Home")'">
                        顯示更多餐廳
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>


@section topCSS {
    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.7.2/dist/css/uikit.min.css" />

    @*LEO 商店卡片 CSS*@
    <style>
        .lookup {
            display: unset;
        }

        * {
            max-width: 100%;
        }

        .pic {
            width: 100%;
        }

        .unitContainer {
            display: block;
            max-width: 98%;
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }

        .p1 {
            /*  margin: 0 16px;*/
            white-space: pre-wrap;
        }

        .Tag {
            line-height: 16px;
            display: inline-block;
            background-color: #05a357;
            border-radius: 0 24px 24px 0;
            color: #ffff;
            font-size: 14px;
            padding: 4px 12px;
            position: absolute;
            left: 0;
            top: 10px;
        }

        .headline {
            position: relative;
            width: 100%;
            height: 164px;
        }

            .headline img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .cardCol {
            margin-bottom: 30px;
            display: flex;
            position: relative;
        }

        .touchZone {
            position: absolute;
            top: 0;
            right: 0;
        }

        .foodCard {
            width: 100%;
        }

        .favoriteHeart {
            display: flex;
            height: 28px;
            width: 50px;
            justify-content: flex-start;
            align-items: center;
            /*position: absolute;*/
            right: 0;
            top: 10px;
        }

        .switchP {
            position: relative;
            display: flex;
            width: 20px;
            height: 20px;
            justify-content: center;
            align-items: center;
        }

        .hSolid4hover {
            z-index: 2;
            position: absolute;
            color: rgb(177, 177, 177);
            display: none;
        }

        .hEmpty {
            position: absolute;
            color: rgb(253, 253, 253);
        }

        /*     .switchP:hover .hEmpty {
                    display: none;
                }

                .switchP:hover .hSolid4hover {
                    z-index: 2;
                    display: block;
                }
        */
        .hSolid {
            z-index: 2;
            position: absolute;
            color: rgb(253, 253, 253);
            /*   display: none;*/
        }

        .shopNameandPoint {
            display: flex;
            font-weight: 500;
            width: 100%;
            margin-top: 12px;
            align-items: center;
            flex-flow: wrap row;
            justify-content: space-between;
            color: black;
        }

        .point {
            display: flex;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #EEEEEE;
            font-size: 12px;
            justify-content: center;
            align-items: center;
        }

        .shopName {
            font-size: 20px;
        }

        .TWD {
            display: flex;
            color: black;
        }

        .dotSpace {
            margin: 0 10px 0 10px;
        }
    </style>

    @*首頁*@
    <style>

        #cellphone-subcategory {
            margin-top: 180px;
        }
        /* 內容 */
        main {
            padding: 0px 20px;
            max-width: 1920px;
            margin: auto;
        }

        /* 主分類 */
        #maincategory {
            margin-top: 190px;
            max-width: 100%;
            height: 150px;
            border: 1000px;
            border-color: red;
        }

            #maincategory li {
                list-style: none;
            }

            #maincategory img {
                width: 80px;
                height: 80px;
                min-width: 80px;
            }

            #maincategory span {
                color: #000;
                font-size: 16px;
            }

        /* 活動店家(幻燈片) */
        #eventstore {
            padding: 2%;
        }

            #eventstore img {
                border-radius: 15px;
                height: 100%;
            }

            #eventstore li {
                padding-left: 45px;
            }

            #eventstore .uk-panel {
                height: 100%;
            }

        /* 商店類別 */
        #storecategory {
            padding: 2%;
        }

            #storecategory h2 {
                font-size: 36px;
                font-weight: 700;
            }

            #storecategory .uk-panel {
                height: 100%;
            }

        /* 店家卡片(幻燈片) */
        .blocktitle a {
            font-size: 20px;
        }

        .storecard img {
            width: 100%;
            height: 100%;
        }

        .storecard li {
            padding-left: 32px;
        }

        /* 副分類 */
        #subcategory {
            width: 300px;
            height: 700px;
        }

        .sticky-top {
            z-index: 3;
        }
        /* 副分類選單(關) */
        .subcategory .uk-accordion-title::before {
            background-image: url(https://img.icons8.com/ios-glyphs/30/000000/expand-arrow--v1.png);
            width: 12px;
        }

        /* 副分類選單(開) */
        .subcategory .uk-open > .uk-accordion-title::before {
            transform: rotate(180deg);
            background-image: url(https://img.icons8.com/ios-glyphs/30/000000/expand-arrow--v1.png);
            width: 12px;
        }

        .subcategory .form-check {
            width: 220px;
            height: 22px;
        }

        .subcategory .form-check-space {
            height: 18px;
        }

        .subcategory .form-check-input {
            width: 22px;
            height: 22px;
            margin: 0 0 0 -20px;
        }

        .subcategory .form-check-label {
            height: 22px;
            font-size: 16px;
            margin: 0 0 0 16px;
            text-align: left;
            width: 100%;
        }

        .subcategory .uk-slidenav {
            padding: 0;
        }

        .subcategory .uk-accordion-content button {
            background-color: #eee;
        }

            .subcategory .uk-accordion-content button:focus {
                background-color: #000;
                color: #fff;
            }
        
            .subcategory .uk-accordion-content .active {
                background-color: #000;
                color: #fff;
            }

        .subcategory #restrict-container button {
            margin: 5px;
        }


        /*邀請好友*/
        #ToEatPass {
            margin: 20px;
        }

            #ToEatPass p {
                font-size: 28px;
            }

            #ToEatPass img {
                padding-right: 10px;
            }

        @@media screen and (max-width:992px) {

            main {
                padding: 0px 12px;
            }

            #subcategory {
                display: none;
            }

            #ToEatPass p {
                text-align: start;
                font-size: 22px;
            }

            #btn-wrap {
                display: flex;
            }

            #eventstore img {
                /*min-width: 423px;*/
                /*  width:292px;
                height:164px;*/
            }

            #eventstore .uk-panel {
                height: 100%;
                width: 100%;
            }
        }

        @@media screen and (min-width:992px) {
            * {
                max-width: unset;
            }

            #maincategory {
                margin-top: 0;
            }

            .lookup {
                display: flex;
            }

            #eventstore img {
                min-width: 423px;
            }

            .uk-grid {
                margin-left: -5px;
            }

            #btn-wrap {
                justify-content: center;
            }

            #cellphonesubcategory {
                display: none;
            }

            #shopcategory {
                max-width: calc(100% - 300px);
            }
        }
    </style>
}

@section endJS {
    @*LEO 商店卡片*@

    @*<Script>
            function clickChangeC() {

                let solid = event.path[1].childNodes[7];
                let empty = event.path[1].childNodes[3];

                if (solid.style.display == "block") {
                    solid.style.display = "none"
                    empty.style.display = "block"
                }
                else {
                    solid.style.display = "block"
                    empty.style.display = "none"
                }
            };


        </Script>*@
    <Script>
        function clickChangeC(storeId, id) {
            let heart = document.getElementById(id);
            //實心轉空心
            if (heart.children[0].classList.contains('fas')) {
                heart.children[0].classList.remove('fas');
                heart.children[0].classList.add('far');
                $.ajax({
                    type: 'POST',
                    url: '/Store/DeleteFavoriteStore',
                    data: { "storeId": storeId },
                    success: function (res) {
                        if (res.length > 0) {
                            window.location.href = res;
                        }
                    }
                });
            }
            //空心轉實心
            else {
                heart.children[0].classList.remove('far');
                heart.children[0].classList.add('fas');
                $.ajax({
                    type: 'POST',
                    url: '/Store/CreateFavoriteStore',
                    data: { "storeId": storeId },
                    //如果>0 沒登入(傳網址)
                    success: function (res) {
                        if (res.length > 0) {
                            window.location.href = res;
                        }
                    }
                });
            }
        }
    </Script>

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.2/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.2/dist/js/uikit-icons.min.js"></script>
}
